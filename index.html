<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Stock Management System</title>
    <link href="https://cdn.jsdelivr.net/npm/tailwindcss@2.2.19/dist/tailwind.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            margin: 0;
            padding: 0;
            background-color: #f8f9fa;
            color: #212529;
        }

        .app-container {
            display: flex;
            height: 100vh;
        }

        .sidebar {
            width: 250px;
            background-color: white;
            border-right: 1px solid #e5e7eb;
            padding: 1rem;
            box-shadow: 2px 0 5px rgba(0, 0, 0, 0.05);
        }

        .content {
            flex: 1;
            padding: 1.5rem;
            overflow-y: auto;
        }

        .nav-item {
            padding: 0.75rem 1rem;
            border-radius: 0.375rem;
            margin-bottom: 0.5rem;
            display: flex;
            align-items: center;
            cursor: pointer;
            transition: all 0.2s;
        }

        .nav-item:hover {
            background-color: #f3f4f6;
        }

        .nav-item.active {
            background-color: #f3f4f6;
            font-weight: 600;
        }

        .nav-item i {
            margin-right: 0.75rem;
            width: 20px;
            text-align: center;
        }

        .card {
            background-color: white;
            border-radius: 0.5rem;
            box-shadow: 0 2px 5px rgba(0, 0, 0, 0.05);
            padding: 1.5rem;
            margin-bottom: 1.5rem;
        }

        .card-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 1rem;
        }

        table {
            width: 100%;
            border-collapse: collapse;
        }

        table th,
        table td {
            padding: 0.75rem 1rem;
            text-align: left;
            border-bottom: 1px solid #e5e7eb;
        }

        table th {
            font-weight: 600;
            color: #6b7280;
            background-color: #f9fafb;
        }

        .btn {
            display: inline-flex;
            align-items: center;
            justify-content: center;
            padding: 0.5rem 1rem;
            border-radius: 0.375rem;
            font-size: 0.875rem;
            font-weight: 500;
            cursor: pointer;
            transition: all 0.2s;
        }

        .btn-primary {
            background-color: black;
            color: white;
        }

        .btn-primary:hover {
            background-color: #1a1a1a;
        }

        .btn-secondary {
            background-color: #f3f4f6;
            color: #4b5563;
        }

        .btn-secondary:hover {
            background-color: #e5e7eb;
        }

        .btn i {
            margin-right: 0.5rem;
        }

        .form-group {
            margin-bottom: 0.75rem;
            /* Reduced from 1rem */
        }

        .form-group label {
            display: block;
            margin-bottom: 0.5rem;
            font-weight: 500;
            color: #4b5563;
        }

        .form-control {
            width: 100%;
            padding: 0.4rem 0.75rem;
            /* Reduced top/bottom padding */
            border: 1px solid #d1d5db;
            border-radius: 0.375rem;
            background-color: white;
            color: #1f2937;
        }

        .modal {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.5);
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 50;
        }

        .modal-content {
            background-color: white;
            border-radius: 0.5rem;
            width: 100%;
            max-width: 500px;
            max-height: 90vh;
            /* Limit height to 90% of viewport height */
            overflow-y: auto;
            /* Add scrolling for tall content */
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
            padding: 1.5rem;
        }

        .modal-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 1rem;
        }

        .modal-title {
            font-size: 1.25rem;
            font-weight: 600;
        }

        .modal-close {
            cursor: pointer;
            color: #6b7280;
        }

        .badge {
            display: inline-block;
            padding: 0.25rem 0.5rem;
            border-radius: 0.25rem;
            font-size: 0.75rem;
            font-weight: 500;
        }

        .badge-success {
            background-color: #d1fae5;
            color: #065f46;
        }

        .badge-danger {
            background-color: #fee2e2;
            color: #b91c1c;
        }

        .status-indicator {
            display: inline-block;
            width: 0.75rem;
            height: 0.75rem;
            border-radius: 50%;
            margin-right: 0.5rem;
        }

        .status-success {
            background-color: #10b981;
        }

        .status-warning {
            background-color: #f59e0b;
        }

        .status-danger {
            background-color: #ef4444;
        }

        .summary-box {
            background-color: white;
            border-radius: 0.5rem;
            box-shadow: 0 2px 5px rgba(0, 0, 0, 0.05);
            padding: 1.5rem;
            display: flex;
            align-items: center;
            margin-bottom: 1.5rem;
        }

        .summary-box-icon {
            width: 48px;
            height: 48px;
            border-radius: 0.5rem;
            background-color: #f3f4f6;
            display: flex;
            align-items: center;
            justify-content: center;
            margin-right: 1rem;
        }

        .summary-box-icon i {
            font-size: 1.5rem;
            color: black;
        }

        .summary-box-content h3 {
            font-size: 1.5rem;
            font-weight: 600;
            margin: 0 0 0.25rem 0;
        }

        .summary-box-content p {
            color: #6b7280;
            margin: 0;
        }

        .grid {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 1rem;
            /* Reduced from 1.5rem */
        }

        #expense-summary .grid {
            grid-template-columns: repeat(auto-fill, minmax(200px, 1fr));
            /* More responsive grid */
        }

        #expense-summary .summary-box {
            padding: 1rem;
            /* Reduced from 1.5rem */
        }

        #expense-summary .summary-box-icon {
            width: 36px;
            /* Reduced from 48px */
            height: 36px;
        }

        #expense-summary .summary-box-content h3 {
            font-size: 1.2rem;
            /* Reduced from 1.5rem */
        }

        .tab-container {
            margin-bottom: 1.5rem;
        }

        .tabs {
            display: flex;
            border-bottom: 1px solid #e5e7eb;
        }

        .tab {
            padding: 0.75rem 1.5rem;
            border-bottom: 2px solid transparent;
            cursor: pointer;
        }

        .tab.active {
            border-bottom: 2px solid black;
            font-weight: 600;
        }

        /* Hide all pages by default */
        .page {
            display: none;
        }

        /* Show active page */
        .page.active {
            display: block;
        }

        /* Chart styles */
        .chart-container {
            position: relative;
            height: 300px;
            margin-bottom: 1.5rem;
        }

        /* Loader */
        .loader {
            border: 3px solid #f3f4f6;
            border-top: 3px solid black;
            border-radius: 50%;
            width: 24px;
            height: 24px;
            animation: spin 1s linear infinite;
            margin: 0 auto;
        }

        @keyframes spin {
            0% {
                transform: rotate(0deg);
            }

            100% {
                transform: rotate(360deg);
            }
        }

        /* Toast notification */
        .toast {
            position: fixed;
            bottom: 1.5rem;
            right: 1.5rem;
            padding: 1rem 1.5rem;
            background-color: white;
            border-radius: 0.375rem;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
            display: flex;
            align-items: center;
            z-index: 100;
            transform: translateY(100%);
            opacity: 0;
            transition: all 0.3s;
        }

        .toast.show {
            transform: translateY(0);
            opacity: 1;
        }

        .toast-success {
            border-left: 4px solid #10b981;
        }

        .toast-error {
            border-left: 4px solid #ef4444;
        }

        .toast-icon {
            margin-right: 0.75rem;
        }

        .toast-content {
            flex: 1;
        }

        .toast-close {
            cursor: pointer;
            color: #6b7280;
            margin-left: 0.75rem;
        }

        @media (max-width: 640px) {
            .modal-content {
                max-width: 90%;
                padding: 1rem;
            }

            .btn {
                padding: 0.4rem 0.75rem;
            }
        }
    </style>
</head>

<body>
    <div class="app-container">
        <!-- Sidebar -->
        <div class="sidebar">
            <div class="mb-6">
                <h1 class="text-xl font-bold mb-1">Stock Management</h1>
                <p class="text-sm text-gray-500">v1.0.0</p>
            </div>

            <div class="nav-item active" data-page="dashboard">
                <i class="fas fa-th-large"></i>
                <span>Dashboard</span>
            </div>

            <div class="nav-item" data-page="stock">
                <i class="fas fa-boxes"></i>
                <span>Stock Management</span>
            </div>

            <div class="nav-item" data-page="ledger">
                <i class="fas fa-book"></i>
                <span>Ledger</span>
            </div>

            <div class="nav-item" data-page="transactions">
                <i class="fas fa-money-bill-wave"></i>
                <span>Expenses</span>
            </div>

            <div class="mt-auto pt-6">
                <div class="text-xs text-gray-500 mb-2">Current User</div>
                <div class="flex items-center">
                    <div class="w-8 h-8 rounded-full bg-gray-200 flex items-center justify-center mr-2">
                        <i class="fas fa-user text-gray-500"></i>
                    </div>
                    <div>
                        <div class="font-medium">itshassanraza</div>
                        <div class="text-xs text-gray-500">2025-04-04</div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Content -->
        <div class="content">
            <!-- Dashboard Page -->
            <div class="page active" id="dashboard-page">
                <div class="card-header">
                    <h2 class="text-xl font-bold">Dashboard</h2>
                    <div>
                        <button class="btn btn-secondary mr-2" id="backup-btn">
                            <i class="fas fa-download"></i> Backup
                        </button>
                        <button class="btn btn-secondary" id="restore-btn">
                            <i class="fas fa-upload"></i> Restore
                        </button>
                    </div>
                </div>

                <div class="grid">
                    <div class="summary-box">
                        <div class="summary-box-icon">
                            <i class="fas fa-boxes"></i>
                        </div>
                        <div class="summary-box-content">
                            <h3 id="total-stock-value">$0.00</h3>
                            <p>Total Stock Value</p>
                        </div>
                    </div>

                    <div class="summary-box">
                        <div class="summary-box-icon">
                            <i class="fas fa-users"></i>
                        </div>
                        <div class="summary-box-content">
                            <h3 id="total-customers">0</h3>
                            <p>Total Customers</p>
                        </div>
                    </div>

                    <div class="summary-box">
                        <div class="summary-box-icon">
                            <i class="fas fa-money-bill-wave"></i>
                        </div>
                        <div class="summary-box-content">
                            <h3 id="total-expenses">$0.00</h3>
                            <p>Total Expenses</p>
                        </div>
                    </div>
                </div>

                <div class="card">
                    <div class="card-header">
                        <h3 class="text-lg font-medium">Stock Overview</h3>
                    </div>
                    <div class="chart-container">
                        <canvas id="stock-chart"></canvas>
                    </div>
                </div>

                <div class="card">
                    <div class="card-header">
                        <h3 class="text-lg font-medium">Expense Breakdown</h3>
                    </div>
                    <div class="chart-container">
                        <canvas id="expense-chart"></canvas>
                    </div>
                </div>
            </div>

            <!-- Stock Management Page -->
            <div class="page" id="stock-page">
                <div class="card-header">
                    <h2 class="text-xl font-bold">Stock Management</h2>
                    <div>
                        <button class="btn btn-secondary mr-2" id="generate-stock-pdf">
                            <i class="fas fa-file-pdf"></i> Generate PDF
                        </button>
                        <button class="btn btn-secondary mr-2" id="add-category-btn">
                            <i class="fas fa-plus"></i> Add Category
                        </button>
                        <button class="btn btn-primary" id="add-stock-btn">
                            <i class="fas fa-plus"></i> Add Stock
                        </button>
                    </div>
                </div>

                <div class="card">
                    <div class="card-header">
                        <h3 class="text-lg font-medium">Stock Summary</h3>
                    </div>
                    <table id="stock-summary-table">
                        <thead>
                            <tr>
                                <th>Item Name</th>
                                <th>Category</th>
                                <th>Total Quantity</th>
                                <th>Average Price</th>
                                <th>Value</th>
                            </tr>
                        </thead>
                        <tbody id="stock-summary-body">
                            <!-- Stock summary data will be inserted here -->
                        </tbody>
                    </table>
                </div>

                <div class="card">
                    <div class="card-header">
                        <h3 class="text-lg font-medium">Stock Entries</h3>
                    </div>
                    <table id="stock-entries-table">
                        <thead>
                            <tr>
                                <th>Date</th>
                                <th>Item Name</th>
                                <th>Category</th>
                                <th>Color</th>
                                <th>Quantity</th>
                                <th>Price</th>
                                <th>Total</th>
                            </tr>
                        </thead>
                        <tbody id="stock-entries-body">
                            <!-- Stock entries data will be inserted here -->
                        </tbody>
                    </table>
                </div>
            </div>

            <!-- Ledger Page -->
            <div class="page" id="ledger-page">
                <div class="card-header">
                    <h2 class="text-xl font-bold">Ledger</h2>
                    <div>
                        <button class="btn btn-secondary mr-2" id="generate-ledger-pdf">
                            <i class="fas fa-file-pdf"></i> Generate PDF
                        </button>
                        <button class="btn btn-primary" id="add-customer-btn">
                            <i class="fas fa-plus"></i> Add Customer
                        </button>
                    </div>
                </div>

                <div class="card">
                    <div class="card-header">
                        <h3 class="text-lg font-medium">Customers Summary</h3>
                    </div>
                    <table id="customers-table">
                        <thead>
                            <tr>
                                <th>Customer Name</th>
                                <th>Total Debit</th>
                                <th>Total Credit</th>
                                <th>Balance</th>
                                <th>Actions</th>
                            </tr>
                        </thead>
                        <tbody id="customers-body">
                            <!-- Customers data will be inserted here -->
                        </tbody>
                    </table>
                </div>
            </div>

            <!-- Customer Ledger Page (dynamically shown) -->
            <div class="page" id="customer-ledger-page">
                <div class="card-header">
                    <h2 class="text-xl font-bold">
                        <button class="btn btn-secondary mr-2" id="back-to-ledger-btn">
                            <i class="fas fa-arrow-left"></i>
                        </button>
                        <span id="customer-name-title">Customer Ledger</span>
                    </h2>
                    <div>
                        <button class="btn btn-secondary mr-2" id="generate-customer-ledger-pdf">
                            <i class="fas fa-file-pdf"></i> Generate PDF
                        </button>
                        <button class="btn btn-primary" id="add-transaction-btn">
                            <i class="fas fa-plus"></i> Add Transaction
                        </button>
                    </div>
                </div>

                <div class="card">
                    <div class="card-header">
                        <h3 class="text-lg font-medium">Customer Summary</h3>
                    </div>
                    <div class="grid">
                        <div class="summary-box">
                            <div class="summary-box-icon">
                                <i class="fas fa-arrow-up"></i>
                            </div>
                            <div class="summary-box-content">
                                <h3 id="customer-total-debit">$0.00</h3>
                                <p>Total Debit</p>
                            </div>
                        </div>

                        <div class="summary-box">
                            <div class="summary-box-icon">
                                <i class="fas fa-arrow-down"></i>
                            </div>
                            <div class="summary-box-content">
                                <h3 id="customer-total-credit">$0.00</h3>
                                <p>Total Credit</p>
                            </div>
                        </div>

                        <div class="summary-box">
                            <div class="summary-box-icon">
                                <i class="fas fa-balance-scale"></i>
                            </div>
                            <div class="summary-box-content">
                                <h3 id="customer-balance">$0.00</h3>
                                <p>Balance</p>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="card">
                    <div class="card-header">
                        <h3 class="text-lg font-medium">Transaction History</h3>
                    </div>
                    <table id="customer-ledger-table">
                        <thead>
                            <tr>
                                <th>Date</th>
                                <th>Title</th>
                                <th>Description</th>
                                <th>Reference</th>
                                <th>Product</th>
                                <th>Debit</th>
                                <th>Credit</th>
                                <th>Balance</th>
                            </tr>
                        </thead>
                        <tbody id="customer-ledger-body">
                            <!-- Ledger entries will be inserted here -->
                        </tbody>
                    </table>
                </div>
            </div>

            <!-- Transactions/Expenses Page -->
            <div class="page" id="transactions-page">
                <div class="card-header">
                    <h2 class="text-xl font-bold">Expenses</h2>
                    <div>
                        <button class="btn btn-secondary mr-2" id="generate-expense-pdf">
                            <i class="fas fa-file-pdf"></i> Generate PDF
                        </button>
                        <button class="btn btn-secondary mr-2" id="add-expense-category-btn">
                            <i class="fas fa-plus"></i> Add Category
                        </button>
                        <button class="btn btn-primary" id="add-expense-btn">
                            <i class="fas fa-plus"></i> Add Expense
                        </button>
                    </div>
                </div>

                <div class="card">
                    <div class="card-header">
                        <h3 class="text-lg font-medium">Expense Summary</h3>
                    </div>
                    <div id="expense-summary">
                        <!-- Expense summary will be inserted here -->
                    </div>
                </div>

                <div class="card">
                    <div class="card-header">
                        <h3 class="text-lg font-medium">Expense History</h3>
                    </div>
                    <table id="expenses-table">
                        <thead>
                            <tr>
                                <th>Date</th>
                                <th>Category</th>
                                <th>Title</th>
                                <th>Description</th>
                                <th>Amount</th>
                                <th>Type</th>
                            </tr>
                        </thead>
                        <tbody id="expenses-body">
                            <!-- Expenses data will be inserted here -->
                        </tbody>
                    </table>
                </div>
            </div>
        </div>
    </div>

    <!-- Modals -->
    <!-- Add Stock Modal -->
    <div class="modal" id="add-stock-modal" style="display: none;">
        <div class="modal-content">
            <div class="modal-header">
                <h3 class="modal-title">Add Stock</h3>
                <span class="modal-close" id="close-add-stock-modal">&times;</span>
            </div>
            <form id="add-stock-form">
                <div class="form-group">
                    <label for="stock-name">Item Name</label>
                    <input type="text" id="stock-name" class="form-control" required>
                </div>
                <div class="form-group">
                    <label for="stock-category">Category</label>
                    <select id="stock-category" class="form-control" required>
                        <!-- Categories will be loaded here -->
                    </select>
                </div>
                <div class="form-group">
                    <label for="stock-color">Color</label>
                    <input type="text" id="stock-color" class="form-control">
                </div>
                <div class="form-group">
                    <label for="stock-quantity">Quantity</label>
                    <input type="number" id="stock-quantity" class="form-control" min="1" required>
                </div>
                <div class="form-group">
                    <label for="stock-price">Price per Unit</label>
                    <input type="number" id="stock-price" class="form-control" min="0" step="0.01" required>
                </div>
                <div class="form-group">
                    <label for="stock-date">Date</label>
                    <input type="date" id="stock-date" class="form-control" required>
                </div>
                <button type="submit" class="btn btn-primary w-full">Add Stock</button>
            </form>
        </div>
    </div>

    <!-- Add Category Modal -->
    <div class="modal" id="add-category-modal" style="display: none;">
        <div class="modal-content">
            <div class="modal-header">
                <h3 class="modal-title">Add Category</h3>
                <span class="modal-close" id="close-add-category-modal">&times;</span>
            </div>
            <form id="add-category-form">
                <div class="form-group">
                    <label for="category-name">Category Name</label>
                    <input type="text" id="category-name" class="form-control" required>
                </div>
                <button type="submit" class="btn btn-primary w-full">Add Category</button>
            </form>
        </div>
    </div>

    <!-- Add Customer Modal -->
    <div class="modal" id="add-customer-modal" style="display: none;">
        <div class="modal-content">
            <div class="modal-header">
                <h3 class="modal-title">Add Customer</h3>
                <span class="modal-close" id="close-add-customer-modal">&times;</span>
            </div>
            <form id="add-customer-form">
                <div class="form-group">
                    <label for="customer-name">Customer Name</label>
                    <input type="text" id="customer-name" class="form-control" required>
                </div>
                <div class="form-group">
                    <label for="customer-phone">Phone Number</label>
                    <input type="text" id="customer-phone" class="form-control">
                </div>
                <div class="form-group">
                    <label for="customer-email">Email</label>
                    <input type="email" id="customer-email" class="form-control">
                </div>
                <div class="form-group">
                    <label for="customer-address">Address</label>
                    <textarea id="customer-address" class="form-control" rows="2"></textarea>
                </div>
                <button type="submit" class="btn btn-primary w-full">Add Customer</button>
            </form>
        </div>
    </div>

    <!-- Add Transaction Modal -->
    <div class="modal" id="add-transaction-modal" style="display: none;">
        <div class="modal-content">
            <div class="modal-header">
                <h3 class="modal-title">Add Transaction</h3>
                <span class="modal-close" id="close-add-transaction-modal">&times;</span>
            </div>
            <form id="add-transaction-form">
                <div class="form-group">
                    <label for="transaction-title">Title</label>
                    <input type="text" id="transaction-title" class="form-control" required>
                </div>
                <div class="form-group">
                    <label for="transaction-description">Description</label>
                    <textarea id="transaction-description" class="form-control" rows="2"></textarea>
                </div>
                <div class="form-group">
                    <label for="transaction-amount">Amount</label>
                    <input type="number" id="transaction-amount" class="form-control" min="0" step="0.01" required>
                </div>
                <div class="form-group">
                    <label for="transaction-reference">Reference No</label>
                    <input type="text" id="transaction-reference" class="form-control">
                </div>
                <div class="form-group">
                    <label for="transaction-date">Date</label>
                    <input type="date" id="transaction-date" class="form-control" required>
                </div>
                <div class="form-group">
                    <label for="transaction-product">Product (Optional)</label>
                    <select id="transaction-product" class="form-control">
                        <option value="">-- Select Product --</option>
                        <!-- Products will be loaded here -->
                    </select>
                </div>
                <div class="form-group" id="product-quantity-group" style="display: none;">
                    <label for="product-quantity">Product Quantity</label>
                    <input type="number" id="product-quantity" class="form-control" min="1" value="1">
                </div>
                <div class="form-group">
                    <label>Transaction Type</label>
                    <div class="flex mt-2">
                        <label class="inline-flex items-center mr-4">
                            <input type="radio" name="transaction-type" value="debit" checked>
                            <span class="ml-2">Debit (You Give)</span>
                        </label>
                        <label class="inline-flex items-center">
                            <input type="radio" name="transaction-type" value="credit">
                            <span class="ml-2">Credit (You Get)</span>
                        </label>
                    </div>
                </div>
                <button type="submit" class="btn btn-primary w-full">Add Transaction</button>
            </form>
        </div>
    </div>

    <!-- Add Expense Category Modal -->
    <div class="modal" id="add-expense-category-modal" style="display: none;">
        <div class="modal-content">
            <div class="modal-header">
                <h3 class="modal-title">Add Expense Category</h3>
                <span class="modal-close" id="close-add-expense-category-modal">&times;</span>
            </div>
            <form id="add-expense-category-form">
                <div class="form-group">
                    <label for="expense-category-name">Category Name</label>
                    <input type="text" id="expense-category-name" class="form-control" required>
                </div>
                <button type="submit" class="btn btn-primary w-full">Add Category</button>
            </form>
        </div>
    </div>

    <!-- Add Expense Modal -->
    <div class="modal" id="add-expense-modal" style="display: none;">
        <div class="modal-content">
            <div class="modal-header">
                <h3 class="modal-title">Add Expense</h3>
                <span class="modal-close" id="close-add-expense-modal">&times;</span>
            </div>
            <form id="add-expense-form">
                <div class="form-group">
                    <label for="expense-category">Category</label>
                    <select id="expense-category" class="form-control" required>
                        <!-- Expense categories will be loaded here -->
                    </select>
                </div>
                <div class="form-group">
                    <label for="expense-title">Title</label>
                    <input type="text" id="expense-title" class="form-control" required>
                </div>
                <div class="form-group">
                    <label for="expense-description">Description</label>
                    <textarea id="expense-description" class="form-control" rows="2"></textarea>
                </div>
                <div class="form-group">
                    <label for="expense-amount">Amount</label>
                    <input type="number" id="expense-amount" class="form-control" min="0" step="0.01" required>
                </div>
                <div class="form-group">
                    <label for="expense-date">Date</label>
                    <input type="date" id="expense-date" class="form-control" required>
                </div>
                <div class="form-group">
                    <label>Transaction Type</label>
                    <div class="flex mt-2">
                        <label class="inline-flex items-center mr-4">
                            <input type="radio" name="expense-type" value="debit" checked>
                            <span class="ml-2">Debit (Expense)</span>
                        </label>
                        <label class="inline-flex items-center">
                            <input type="radio" name="expense-type" value="credit">
                            <span class="ml-2">Credit (Income)</span>
                        </label>
                    </div>
                </div>
                <button type="submit" class="btn btn-primary w-full">Add Expense</button>
            </form>
        </div>
    </div>

    <!-- Generate PDF Modal -->
    <div class="modal" id="generate-pdf-modal" style="display: none;">
        <div class="modal-content">
            <div class="modal-header">
                <h3 class="modal-title">Generate PDF Report</h3>
                <span class="modal-close" id="close-generate-pdf-modal">&times;</span>
            </div>
            <form id="generate-pdf-form">
                <div class="form-group">
                    <label for="pdf-start-date">Start Date</label>
                    <input type="date" id="pdf-start-date" class="form-control" required>
                </div>
                <div class="form-group">
                    <label for="pdf-end-date">End Date</label>
                    <input type="date" id="pdf-end-date" class="form-control" required>
                </div>
                <button type="submit" class="btn btn-primary w-full">Generate PDF</button>
            </form>
        </div>
    </div>

    <!-- Toast Notification -->
    <div class="toast" id="toast-notification">
        <div class="toast-icon">
            <i class="fas fa-check-circle text-green-500"></i>
        </div>
        <div class="toast-content">
            <div class="font-medium" id="toast-title">Success</div>
            <div class="text-sm text-gray-500" id="toast-message">Operation completed successfully.</div>
        </div>
        <div class="toast-close">&times;</div>
    </div>

    <!-- Scripts -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js@3.7.1/dist/chart.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf-autotable/3.5.31/jspdf.plugin.autotable.min.js"></script>

    <script>
        // Get references to HTML elements
        const { ipcRenderer } = require('electron');
        const navItems = document.querySelectorAll('.nav-item');
        const pages = document.querySelectorAll('.page');
        const toast = document.getElementById('toast-notification');
        const toastTitle = document.getElementById('toast-title');
        const toastMessage = document.getElementById('toast-message');
        const toastClose = document.querySelector('.toast-close');

        // Set current date as default for date inputs
        const today = new Date().toISOString().split('T')[0];
        document.getElementById('stock-date').value = today;
        document.getElementById('transaction-date').value = today;
        document.getElementById('expense-date').value = today;
        document.getElementById('pdf-start-date').value = new Date(Date.now() - 30 * 24 * 60 * 60 * 1000).toISOString().split('T')[0];
        document.getElementById('pdf-end-date').value = today;

        // Global state variables
        let currentCustomerId = null;
        let stockData = [];
        let categoriesData = [];
        let customersData = [];
        let expensesData = [];
        let expenseCategoriesData = [];
        let stockChart = null;
        let expenseChart = null;

        // Utility functions
        function formatCurrency(amount) {
            return new Intl.NumberFormat('en-US', { style: 'currency', currency: 'USD' }).format(amount);
        }

        function formatDate(dateString) {
            const date = new Date(dateString);
            return date.toLocaleDateString('en-US', { year: 'numeric', month: 'short', day: 'numeric' });
        }

        function showToast(title, message, type = 'success') {
            toastTitle.textContent = title;
            toastMessage.textContent = message;

            toast.className = 'toast';
            toast.classList.add(`toast-${type}`);

            const icon = toast.querySelector('.toast-icon i');
            if (type === 'success') {
                icon.className = 'fas fa-check-circle text-green-500';
            } else {
                icon.className = 'fas fa-exclamation-circle text-red-500';
            }

            toast.classList.add('show');

            setTimeout(() => {
                toast.classList.remove('show');
            }, 3000);
        }

        toastClose.addEventListener('click', () => {
            toast.classList.remove('show');
        });

        // Navigation
        navItems.forEach(item => {
            item.addEventListener('click', () => {
                const targetPage = item.getAttribute('data-page');

                // Hide customer ledger page if navigating away from ledger
                if (targetPage !== 'ledger' && document.getElementById('customer-ledger-page').classList.contains('active')) {
                    document.getElementById('customer-ledger-page').classList.remove('active');
                }

                // Update active nav item
                navItems.forEach(nav => nav.classList.remove('active'));
                item.classList.add('active');

                // Show target page
                pages.forEach(page => page.classList.remove('active'));
                document.getElementById(`${targetPage}-page`).classList.add('active');

                // Refresh data for the active page
                if (targetPage === 'dashboard') {
                    loadDashboardData();
                } else if (targetPage === 'stock') {
                    loadStockData();
                } else if (targetPage === 'ledger') {
                    loadCustomersData();
                } else if (targetPage === 'transactions') {
                    loadExpensesData();
                }
            });
        });

        // Modal handlers
        function setupModal(modalId, openBtnId, closeBtnId) {
            const modal = document.getElementById(modalId);
            const openBtn = document.getElementById(openBtnId);
            const closeBtn = document.getElementById(closeBtnId);

            if (openBtn) {
                openBtn.addEventListener('click', () => {
                    modal.style.display = 'flex';
                });
            }

            if (closeBtn) {
                closeBtn.addEventListener('click', () => {
                    modal.style.display = 'none';
                });
            }

            window.addEventListener('click', (event) => {
                if (event.target === modal) {
                    modal.style.display = 'none';
                }
            });
        }

        // Setup modals
        setupModal('add-stock-modal', 'add-stock-btn', 'close-add-stock-modal');
        setupModal('add-category-modal', 'add-category-btn', 'close-add-category-modal');
        setupModal('add-customer-modal', 'add-customer-btn', 'close-add-customer-modal');
        setupModal('add-transaction-modal', 'add-transaction-btn', 'close-add-transaction-modal');
        setupModal('add-expense-category-modal', 'add-expense-category-btn', 'close-add-expense-category-modal');
        setupModal('add-expense-modal', 'add-expense-btn', 'close-add-expense-modal');
        setupModal('generate-pdf-modal', 'generate-stock-pdf', 'close-generate-pdf-modal');

        // Link PDF generation buttons to modal
        document.getElementById('generate-ledger-pdf').addEventListener('click', () => {
            document.getElementById('generate-pdf-modal').style.display = 'flex';
        });

        document.getElementById('generate-customer-ledger-pdf').addEventListener('click', () => {
            document.getElementById('generate-pdf-modal').style.display = 'flex';
        });

        document.getElementById('generate-expense-pdf').addEventListener('click', () => {
            document.getElementById('generate-pdf-modal').style.display = 'flex';
        });

        // Load initial data
        window.addEventListener('DOMContentLoaded', () => {
            loadDashboardData();
            loadCategories();
            loadExpenseCategories();
        });

        // Dashboard Data
        async function loadDashboardData() {
            try {
                // Load all required data
                stockData = await ipcRenderer.invoke('get-stocks');
                customersData = await ipcRenderer.invoke('get-customers');
                expensesData = await ipcRenderer.invoke('get-expenses');

                // Calculate totals
                let totalStockValue = 0;

                // Process stock data for summary and chart
                const stockSummary = {};

                stockData.forEach(stock => {
                    const value = stock.quantity * stock.price;
                    totalStockValue += value;

                    // Group by category for chart
                    if (!stockSummary[stock.category]) {
                        stockSummary[stock.category] = 0;
                    }
                    stockSummary[stock.category] += value;
                });

                // Process expense data for chart
                const expenseSummary = {};
                let totalExpenses = 0;

                expensesData.forEach(expense => {
                    const amount = expense.amount;

                    if (expense.type === 'debit') {
                        totalExpenses += amount;

                        // Group by category for chart
                        if (!expenseSummary[expense.category]) {
                            expenseSummary[expense.category] = 0;
                        }
                        expenseSummary[expense.category] += amount;
                    }
                });

                // Update summary boxes
                document.getElementById('total-stock-value').textContent = formatCurrency(totalStockValue);
                document.getElementById('total-customers').textContent = customersData.length;
                document.getElementById('total-expenses').textContent = formatCurrency(totalExpenses);

                // Update charts
                updateStockChart(stockSummary);
                updateExpenseChart(expenseSummary);

            } catch (error) {
                console.error('Error loading dashboard data:', error);
                showToast('Error', 'Failed to load dashboard data', 'error');
            }
        }

        // Stock Chart
        function updateStockChart(stockSummary) {
            const ctx = document.getElementById('stock-chart').getContext('2d');

            // Destroy existing chart if it exists
            if (stockChart) {
                stockChart.destroy();
            }

            // Prepare data for chart
            const labels = Object.keys(stockSummary);
            const data = Object.values(stockSummary);

            // Create chart
            stockChart = new Chart(ctx, {
                type: 'bar',
                data: {
                    labels: labels,
                    datasets: [{
                        label: 'Stock Value by Category',
                        data: data,
                        backgroundColor: 'rgba(0, 0, 0, 0.7)',
                        borderColor: 'rgba(0, 0, 0, 1)',
                        borderWidth: 1
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    scales: {
                        y: {
                            beginAtZero: true,
                            ticks: {
                                callback: function (value) {
                                    return '$' + value;
                                }
                            }
                        }
                    }
                }
            });
        }

        // Expense Chart
        function updateExpenseChart(expenseSummary) {
            const ctx = document.getElementById('expense-chart').getContext('2d');

            // Destroy existing chart if it exists
            if (expenseChart) {
                expenseChart.destroy();
            }

            // Prepare data for chart
            const labels = Object.keys(expenseSummary);
            const data = Object.values(expenseSummary);

            // Generate colors
            const backgroundColors = labels.map((_, index) => {
                const hue = (index * 137) % 360;
                return `hsla(${hue}, 70%, 60%, 0.7)`;
            });

            // Create chart
            expenseChart = new Chart(ctx, {
                type: 'pie',
                data: {
                    labels: labels,
                    datasets: [{
                        label: 'Expenses by Category',
                        data: data,
                        backgroundColor: backgroundColors,
                        borderColor: 'white',
                        borderWidth: 1
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: {
                            position: 'right'
                        },
                        tooltip: {
                            callbacks: {
                                label: function (context) {
                                    const label = context.label || '';
                                    const value = context.raw;
                                    const total = context.dataset.data.reduce((a, b) => a + b, 0);
                                    const percentage = Math.round((value / total) * 100);
                                    return `${label}: ${formatCurrency(value)} (${percentage}%)`;
                                }
                            }
                        }
                    }
                }
            });
        }

        // Stock Management
        async function loadStockData() {
            try {
                stockData = await ipcRenderer.invoke('get-stocks');

                // Process stock data for summary
                const stockSummary = {};

                stockData.forEach(stock => {
                    const key = `${stock.name}`;

                    if (!stockSummary[key]) {
                        stockSummary[key] = {
                            name: stock.name,
                            category: stock.category,
                            totalQuantity: 0,
                            totalValue: 0,
                            entries: []
                        };
                    }

                    stockSummary[key].totalQuantity += stock.quantity;
                    stockSummary[key].totalValue += stock.quantity * stock.price;
                    stockSummary[key].entries.push(stock);
                });

                // Update stock summary table
                const summaryTableBody = document.getElementById('stock-summary-body');
                summaryTableBody.innerHTML = '';

                Object.values(stockSummary).forEach(item => {
                    if (item.totalQuantity > 0) {
                        const averagePrice = item.totalValue / item.totalQuantity;

                        const row = document.createElement('tr');
                        row.innerHTML = `
              <td>${item.name}</td>
              <td>${item.category}</td>
              <td>${item.totalQuantity}</td>
              <td>${formatCurrency(averagePrice)}</td>
              <td>${formatCurrency(item.totalValue)}</td>
            `;
                        summaryTableBody.appendChild(row);
                    }
                });

                // Update stock entries table
                const entriesTableBody = document.getElementById('stock-entries-body');
                entriesTableBody.innerHTML = '';

                stockData.forEach(stock => {
                    const row = document.createElement('tr');
                    row.innerHTML = `
            <td>${formatDate(stock.date)}</td>
            <td>${stock.name}</td>
            <td>${stock.category}</td>
            <td>${stock.color || '-'}</td>
            <td>${stock.quantity}</td>
            <td>${formatCurrency(stock.price)}</td>
            <td>${formatCurrency(stock.quantity * stock.price)}</td>
          `;
                    entriesTableBody.appendChild(row);
                });

            } catch (error) {
                console.error('Error loading stock data:', error);
                showToast('Error', 'Failed to load stock data', 'error');
            }
        }

        // Load Categories
        async function loadCategories() {
            try {
                categoriesData = await ipcRenderer.invoke('get-stock-categories');

                // Update category dropdown in add stock form
                const categorySelect = document.getElementById('stock-category');
                categorySelect.innerHTML = '';

                if (categoriesData.length === 0) {
                    // Add default category if none exist
                    const defaultCategory = { name: 'General' };
                    await ipcRenderer.invoke('add-stock-category', defaultCategory);
                    categoriesData.push(defaultCategory);
                }

                categoriesData.forEach(category => {
                    const option = document.createElement('option');
                    option.value = category.name;
                    option.textContent = category.name;
                    categorySelect.appendChild(option);
                });

            } catch (error) {
                console.error('Error loading categories:', error);
                showToast('Error', 'Failed to load categories', 'error');
            }
        }

        // Load Expense Categories
        async function loadExpenseCategories() {
            try {
                expenseCategoriesData = await ipcRenderer.invoke('get-expense-categories');

                // Update category dropdown in add expense form
                const categorySelect = document.getElementById('expense-category');
                categorySelect.innerHTML = '';

                if (expenseCategoriesData.length === 0) {
                    // Add default categories if none exist
                    const defaultCategories = [
                        { name: 'Shop Expense' },
                        { name: 'Car Expense' },
                        { name: 'Home Expense' },
                        { name: 'Other' }
                    ];

                    for (const category of defaultCategories) {
                        await ipcRenderer.invoke('add-expense-category', category);
                        expenseCategoriesData.push(category);
                    }
                }

                expenseCategoriesData.forEach(category => {
                    const option = document.createElement('option');
                    option.value = category.name;
                    option.textContent = category.name;
                    categorySelect.appendChild(option);
                });

            } catch (error) {
                console.error('Error loading expense categories:', error);
                showToast('Error', 'Failed to load expense categories', 'error');
            }
        }

        // Add Stock Form
        document.getElementById('add-stock-form').addEventListener('submit', async (event) => {
            event.preventDefault();

            const stockData = {
                name: document.getElementById('stock-name').value,
                category: document.getElementById('stock-category').value,
                color: document.getElementById('stock-color').value,
                quantity: parseInt(document.getElementById('stock-quantity').value),
                price: parseFloat(document.getElementById('stock-price').value),
                date: document.getElementById('stock-date').value,
                addedOn: new Date().toISOString()
            };

            try {
                await ipcRenderer.invoke('add-stock', stockData);

                // Reset form and close modal
                document.getElementById('add-stock-form').reset();
                document.getElementById('stock-date').value = today;
                document.getElementById('add-stock-modal').style.display = 'none';

                // Refresh stock data
                loadStockData();
                loadDashboardData();

                showToast('Success', 'Stock added successfully');
            } catch (error) {
                console.error('Error adding stock:', error);
                showToast('Error', 'Failed to add stock', 'error');
            }
        });

        // Add Category Form
        document.getElementById('add-category-form').addEventListener('submit', async (event) => {
            event.preventDefault();

            const categoryData = {
                name: document.getElementById('category-name').value
            };

            try {
                await ipcRenderer.invoke('add-stock-category', categoryData);

                // Reset form and close modal
                document.getElementById('add-category-form').reset();
                document.getElementById('add-category-modal').style.display = 'none';

                // Refresh categories
                loadCategories();

                showToast('Success', 'Category added successfully');
            } catch (error) {
                console.error('Error adding category:', error);
                showToast('Error', 'Failed to add category', 'error');
            }
        });

        // Add Expense Category Form
        document.getElementById('add-expense-category-form').addEventListener('submit', async (event) => {
            event.preventDefault();

            const categoryData = {
                name: document.getElementById('expense-category-name').value
            };

            try {
                await ipcRenderer.invoke('add-expense-category', categoryData);

                // Reset form and close modal
                document.getElementById('add-expense-category-form').reset();
                document.getElementById('add-expense-category-modal').style.display = 'none';

                // Refresh categories
                loadExpenseCategories();

                showToast('Success', 'Expense category added successfully');
            } catch (error) {
                console.error('Error adding expense category:', error);
                showToast('Error', 'Failed to add expense category', 'error');
            }
        });

        // Customers Management
        async function loadCustomersData() {
            try {
                customersData = await ipcRenderer.invoke('get-customers');

                // Get ledger data for all customers to calculate totals
                const ledgerData = {};

                for (const customer of customersData) {
                    const entries = await ipcRenderer.invoke('get-ledger', customer._id);

                    let totalDebit = 0;
                    let totalCredit = 0;

                    entries.forEach(entry => {
                        if (entry.type === 'debit') {
                            totalDebit += entry.amount;
                        } else {
                            totalCredit += entry.amount;
                        }
                    });

                    ledgerData[customer._id] = {
                        totalDebit,
                        totalCredit,
                        balance: totalDebit - totalCredit
                    };
                }

                // Update customers table
                const customersTableBody = document.getElementById('customers-body');
                customersTableBody.innerHTML = '';

                customersData.forEach(customer => {
                    const data = ledgerData[customer._id] || { totalDebit: 0, totalCredit: 0, balance: 0 };

                    const row = document.createElement('tr');
                    row.innerHTML = `
            <td>${customer.name}</td>
            <td>${formatCurrency(data.totalDebit)}</td>
            <td>${formatCurrency(data.totalCredit)}</td>
            <td>${formatCurrency(data.balance)}</td>
            <td>
              <button class="btn btn-secondary btn-sm view-ledger" data-id="${customer._id}" data-name="${customer.name}">
                <i class="fas fa-eye"></i> View Ledger
              </button>
            </td>
          `;
                    customersTableBody.appendChild(row);

                    // Attach event listener to view ledger button
                    const viewLedgerBtn = row.querySelector('.view-ledger');
                    viewLedgerBtn.addEventListener('click', () => {
                        const customerId = viewLedgerBtn.getAttribute('data-id');
                        const customerName = viewLedgerBtn.getAttribute('data-name');
                        viewCustomerLedger(customerId, customerName);
                    });
                });

            } catch (error) {
                console.error('Error loading customers data:', error);
                showToast('Error', 'Failed to load customers data', 'error');
            }
        }

        // Add Customer Form
        document.getElementById('add-customer-form').addEventListener('submit', async (event) => {
            event.preventDefault();

            const customerData = {
                name: document.getElementById('customer-name').value,
                phone: document.getElementById('customer-phone').value,
                email: document.getElementById('customer-email').value,
                address: document.getElementById('customer-address').value,
                createdAt: new Date().toISOString()
            };

            try {
                await ipcRenderer.invoke('add-customer', customerData);

                // Reset form and close modal
                document.getElementById('add-customer-form').reset();
                document.getElementById('add-customer-modal').style.display = 'none';

                // Refresh customers data
                loadCustomersData();
                loadDashboardData();

                showToast('Success', 'Customer added successfully');
            } catch (error) {
                console.error('Error adding customer:', error);
                showToast('Error', 'Failed to add customer', 'error');
            }
        });

        // Customer Ledger
        async function viewCustomerLedger(customerId, customerName) {
            currentCustomerId = customerId;

            // Show customer ledger page
            pages.forEach(page => page.classList.remove('active'));
            document.getElementById('customer-ledger-page').classList.add('active');

            // Set customer name in title
            document.getElementById('customer-name-title').textContent = `${customerName}'s Ledger`;

            // Load ledger data
            try {
                const ledgerEntries = await ipcRenderer.invoke('get-ledger', customerId);

                // Sort by date
                ledgerEntries.sort((a, b) => new Date(a.date) - new Date(b.date));

                // Calculate running balance
                let runningBalance = 0;
                let totalDebit = 0;
                let totalCredit = 0;

                ledgerEntries.forEach(entry => {
                    if (entry.type === 'debit') {
                        runningBalance += entry.amount;
                        totalDebit += entry.amount;
                    } else {
                        runningBalance -= entry.amount;
                        totalCredit += entry.amount;
                    }

                    entry.balance = runningBalance;
                });

                // Update customer summary
                document.getElementById('customer-total-debit').textContent = formatCurrency(totalDebit);
                document.getElementById('customer-total-credit').textContent = formatCurrency(totalCredit);
                document.getElementById('customer-balance').textContent = formatCurrency(runningBalance);

                // Update ledger table
                const ledgerTableBody = document.getElementById('customer-ledger-body');
                ledgerTableBody.innerHTML = '';

                ledgerEntries.forEach(entry => {
                    const row = document.createElement('tr');
                    row.innerHTML = `
            <td>${formatDate(entry.date)}</td>
            <td>${entry.title}</td>
            <td>${entry.description || '-'}</td>
            <td>${entry.reference || '-'}</td>
            <td>${entry.productName || '-'}</td>
            <td>${entry.type === 'debit' ? formatCurrency(entry.amount) : '-'}</td>
            <td>${entry.type === 'credit' ? formatCurrency(entry.amount) : '-'}</td>
            <td>${formatCurrency(entry.balance)}</td>
          `;
                    ledgerTableBody.appendChild(row);
                });

                // Load products for transaction form
                await loadProductsForTransaction();

            } catch (error) {
                console.error('Error loading ledger data:', error);
                showToast('Error', 'Failed to load ledger data', 'error');
            }
        }

        // Load products for transaction form
        async function loadProductsForTransaction() {
            try {
                stockData = await ipcRenderer.invoke('get-stocks');

                // Process stock data for summary (to show available products)
                const stockSummary = {};

                stockData.forEach(stock => {
                    const key = `${stock.name}`;

                    if (!stockSummary[key]) {
                        stockSummary[key] = {
                            id: stock._id,
                            name: stock.name,
                            category: stock.category,
                            totalQuantity: 0,
                            entries: []
                        };
                    }

                    stockSummary[key].totalQuantity += stock.quantity;
                    stockSummary[key].entries.push(stock);
                });

                // Update product dropdown in add transaction form
                const productSelect = document.getElementById('transaction-product');

                // Clear existing options except the first one
                while (productSelect.options.length > 1) {
                    productSelect.remove(1);
                }

                // Add products with quantity > 0
                Object.values(stockSummary)
                    .filter(product => product.totalQuantity > 0)
                    .forEach(product => {
                        const option = document.createElement('option');
                        option.value = product.id;
                        option.textContent = `${product.name} (${product.totalQuantity} available)`;
                        option.dataset.quantity = product.totalQuantity;
                        option.dataset.name = product.name;
                        productSelect.appendChild(option);
                    });

            } catch (error) {
                console.error('Error loading products for transaction:', error);
            }
        }

        // Back to Ledger button
        document.getElementById('back-to-ledger-btn').addEventListener('click', () => {
            pages.forEach(page => page.classList.remove('active'));
            document.getElementById('ledger-page').classList.add('active');

            // Update active nav item
            navItems.forEach(nav => nav.classList.remove('active'));
            document.querySelector('[data-page="ledger"]').classList.add('active');

            // Reset current customer
            currentCustomerId = null;
        });

        // Product quantity toggle in transaction form
        document.getElementById('transaction-product').addEventListener('change', function () {
            const productQuantityGroup = document.getElementById('product-quantity-group');

            if (this.value) {
                productQuantityGroup.style.display = 'block';

                // Get max available quantity
                const selectedOption = this.options[this.selectedIndex];
                const maxQuantity = parseInt(selectedOption.dataset.quantity);

                // Set max attribute on quantity input
                const quantityInput = document.getElementById('product-quantity');
                quantityInput.max = maxQuantity;
                quantityInput.value = 1;
            } else {
                productQuantityGroup.style.display = 'none';
            }
        });

        // Add Transaction Form
        document.getElementById('add-transaction-form').addEventListener('submit', async (event) => {
            event.preventDefault();

            // Get selected product info
            const productSelect = document.getElementById('transaction-product');
            let productId = null;
            let productName = null;
            let productQuantity = null;

            if (productSelect.value) {
                productId = productSelect.value;
                const selectedOption = productSelect.options[productSelect.selectedIndex];
                productName = selectedOption.dataset.name;
                productQuantity = parseInt(document.getElementById('product-quantity').value);
            }

            const transactionData = {
                customerId: currentCustomerId,
                title: document.getElementById('transaction-title').value,
                description: document.getElementById('transaction-description').value,
                amount: parseFloat(document.getElementById('transaction-amount').value),
                reference: document.getElementById('transaction-reference').value,
                date: document.getElementById('transaction-date').value,
                type: document.querySelector('input[name="transaction-type"]:checked').value,
                productId,
                productName,
                productQuantity,
                createdAt: new Date().toISOString()
            };

            try {
                await ipcRenderer.invoke('add-ledger-entry', transactionData);

                // Reset form and close modal
                document.getElementById('add-transaction-form').reset();
                document.getElementById('transaction-date').value = today;
                document.getElementById('add-transaction-modal').style.display = 'none';

                // Refresh ledger data
                viewCustomerLedger(currentCustomerId, document.getElementById('customer-name-title').textContent.replace("'s Ledger", ""));

                showToast('Success', 'Transaction added successfully');
            } catch (error) {
                console.error('Error adding transaction:', error);
                showToast('Error', 'Failed to add transaction', 'error');
            }
        });

        // Expenses Management
        async function loadExpensesData() {
            try {
                expensesData = await ipcRenderer.invoke('get-expenses');
                expenseCategoriesData = await ipcRenderer.invoke('get-expense-categories');

                // Calculate category totals
                const categorySummary = {};
                expenseCategoriesData.forEach(category => {
                    categorySummary[category.name] = {
                        debit: 0,
                        credit: 0
                    };
                });

                expensesData.forEach(expense => {
                    if (!categorySummary[expense.category]) {
                        categorySummary[expense.category] = {
                            debit: 0,
                            credit: 0
                        };
                    }

                    if (expense.type === 'debit') {
                        categorySummary[expense.category].debit += expense.amount;
                    } else {
                        categorySummary[expense.category].credit += expense.amount;
                    }
                });

                // Update expense summary
                const expenseSummary = document.getElementById('expense-summary');
                expenseSummary.innerHTML = '';

                // Create a grid for summary boxes
                const summaryGrid = document.createElement('div');
                summaryGrid.className = 'grid';
                expenseSummary.appendChild(summaryGrid);

                // Calculate totals
                let totalDebit = 0;
                let totalCredit = 0;

                // Add category summary boxes
                Object.entries(categorySummary).forEach(([category, data]) => {
                    totalDebit += data.debit;
                    totalCredit += data.credit;

                    const box = document.createElement('div');
                    box.className = 'summary-box';
                    box.innerHTML = `
            <div class="summary-box-icon">
              <i class="fas fa-tag"></i>
            </div>
            <div class="summary-box-content">
              <h3>${category}</h3>
              <p>Expense: ${formatCurrency(data.debit)} | Income: ${formatCurrency(data.credit)}</p>
              <p>Net: ${formatCurrency(data.credit - data.debit)}</p>
            </div>
          `;
                    summaryGrid.appendChild(box);
                });

                // Add total summary box
                const totalBox = document.createElement('div');
                totalBox.className = 'summary-box';
                totalBox.innerHTML = `
          <div class="summary-box-icon">
            <i class="fas fa-calculator"></i>
          </div>
          <div class="summary-box-content">
            <h3>Total</h3>
            <p>Expense: ${formatCurrency(totalDebit)} | Income: ${formatCurrency(totalCredit)}</p>
            <p>Net: ${formatCurrency(totalCredit - totalDebit)}</p>
          </div>
        `;
                summaryGrid.appendChild(totalBox);

                // Update expenses table
                const expensesTableBody = document.getElementById('expenses-body');
                expensesTableBody.innerHTML = '';

                expensesData.forEach(expense => {
                    const row = document.createElement('tr');
                    row.innerHTML = `
            <td>${formatDate(expense.date)}</td>
            <td>${expense.category}</td>
            <td>${expense.title}</td>
            <td>${expense.description || '-'}</td>
            <td>${formatCurrency(expense.amount)}</td>
            <td>
              <span class="badge ${expense.type === 'debit' ? 'badge-danger' : 'badge-success'}">
                ${expense.type === 'debit' ? 'Expense' : 'Income'}
              </span>
            </td>
          `;
                    expensesTableBody.appendChild(row);
                });

            } catch (error) {
                console.error('Error loading expenses data:', error);
                showToast('Error', 'Failed to load expenses data', 'error');
            }
        }

        // Add Expense Form
        document.getElementById('add-expense-form').addEventListener('submit', async (event) => {
            event.preventDefault();

            const expenseData = {
                category: document.getElementById('expense-category').value,
                title: document.getElementById('expense-title').value,
                description: document.getElementById('expense-description').value,
                amount: parseFloat(document.getElementById('expense-amount').value),
                date: document.getElementById('expense-date').value,
                type: document.querySelector('input[name="expense-type"]:checked').value,
                createdAt: new Date().toISOString()
            };

            try {
                await ipcRenderer.invoke('add-expense', expenseData);

                // Reset form and close modal
                document.getElementById('add-expense-form').reset();
                document.getElementById('expense-date').value = today;
                document.getElementById('add-expense-modal').style.display = 'none';

                // Refresh expenses data
                loadExpensesData();
                loadDashboardData();

                showToast('Success', 'Expense added successfully');
            } catch (error) {
                console.error('Error adding expense:', error);
                showToast('Error', 'Failed to add expense', 'error');
            }
        });

        // PDF Generation
        // Replace the PDF Generation function with this fixed version

// PDF Generation
document.getElementById('generate-pdf-form').addEventListener('submit', async (event) => {
  event.preventDefault();
  
  const startDate = document.getElementById('pdf-start-date').value;
  const endDate = document.getElementById('pdf-end-date').value;
  
  // Determine which page is active to know which report to generate
  let reportType = '';
  let pageTitle = '';
  
  if (document.getElementById('stock-page').classList.contains('active')) {
    reportType = 'stock';
    pageTitle = 'Stock Report';
  } else if (document.getElementById('ledger-page').classList.contains('active')) {
    reportType = 'ledger';
    pageTitle = 'Customers Report';
  } else if (document.getElementById('customer-ledger-page').classList.contains('active')) {
    reportType = 'customer-ledger';
    pageTitle = 'Customer Ledger Report';
  } else if (document.getElementById('transactions-page').classList.contains('active')) {
    reportType = 'expense';
    pageTitle = 'Expense Report';
  }
  
  try {
    // Ensure jsPDF and autoTable are available
    if (typeof window.jspdf === 'undefined' || typeof window.jspdf.jsPDF === 'undefined') {
      throw new Error('jsPDF library not loaded properly');
    }
    
    // Initialize jsPDF
    const { jsPDF } = window.jspdf;
    const doc = new jsPDF();
    
    // Ensure autoTable plugin is available
    if (typeof doc.autoTable !== 'function') {
      throw new Error('AutoTable plugin not loaded properly');
    }
    
    // Add header
    doc.setFontSize(18);
    doc.text(pageTitle, 14, 22);
    
    // Add date range
    doc.setFontSize(10);
    doc.text(`Period: ${formatDate(startDate)} - ${formatDate(endDate)}`, 14, 30);
    doc.text(`Generated on: ${formatDate(new Date())}`, 14, 36);
    doc.text(`Generated by: itshassanraza`, 14, 42);
    
    // Generate report based on type
    if (reportType === 'stock') {
      // Filter stock data by date range
      const filteredStocks = stockData.filter(stock => {
        const stockDate = new Date(stock.date);
        return stockDate >= new Date(startDate) && stockDate <= new Date(endDate);
      });
      
      // Process stock data for summary
      const stockSummary = {};
      
      filteredStocks.forEach(stock => {
        const key = `${stock.name}`;
        
        if (!stockSummary[key]) {
          stockSummary[key] = {
            name: stock.name,
            category: stock.category,
            totalQuantity: 0,
            totalValue: 0
          };
        }
        
        stockSummary[key].totalQuantity += stock.quantity;
        stockSummary[key].totalValue += stock.quantity * stock.price;
      });
      
      // Generate summary table
      doc.autoTable({
        startY: 48,
        head: [['Item Name', 'Category', 'Total Quantity', 'Average Price', 'Value']],
        body: Object.values(stockSummary).map(item => [
          item.name,
          item.category,
          item.totalQuantity,
          formatCurrency(item.totalValue / item.totalQuantity),
          formatCurrency(item.totalValue)
        ]),
        headStyles: { fillColor: [0, 0, 0] }
      });
      
      // Generate entries table
      const finalY = doc.lastAutoTable ? doc.lastAutoTable.finalY : 48;
      
      doc.autoTable({
        startY: finalY + 15,
        head: [['Date', 'Item Name', 'Category', 'Color', 'Quantity', 'Price', 'Total']],
        body: filteredStocks.map(stock => [
          formatDate(stock.date),
          stock.name,
          stock.category,
          stock.color || '-',
          stock.quantity,
          formatCurrency(stock.price),
          formatCurrency(stock.quantity * stock.price)
        ]),
        headStyles: { fillColor: [0, 0, 0] }
      });
      
    } else if (reportType === 'ledger') {
      // Generate customers summary
      const tableData = [];
      
      for (const customer of customersData) {
        const entries = await ipcRenderer.invoke('get-ledger', customer._id);
        
        // Filter by date range
        const filteredEntries = entries.filter(entry => {
          const entryDate = new Date(entry.date);
          return entryDate >= new Date(startDate) && entryDate <= new Date(endDate);
        });
        
        let totalDebit = 0;
        let totalCredit = 0;
        
        filteredEntries.forEach(entry => {
          if (entry.type === 'debit') {
            totalDebit += entry.amount;
          } else {
            totalCredit += entry.amount;
          }
        });
        
        tableData.push([
          customer.name,
          formatCurrency(totalDebit),
          formatCurrency(totalCredit),
          formatCurrency(totalDebit - totalCredit)
        ]);
      }
      
      doc.autoTable({
        startY: 48,
        head: [['Customer Name', 'Total Debit', 'Total Credit', 'Balance']],
        body: tableData,
        headStyles: { fillColor: [0, 0, 0] }
      });
      
    } else if (reportType === 'customer-ledger') {
      // Get customer name
      const customerName = document.getElementById('customer-name-title').textContent.replace("'s Ledger", "");
      
      // Get ledger entries
      const entries = await ipcRenderer.invoke('get-ledger', currentCustomerId);
      
      // Filter by date range
      const filteredEntries = entries.filter(entry => {
        const entryDate = new Date(entry.date);
        return entryDate >= new Date(startDate) && entryDate <= new Date(endDate);
      });
      
      // Sort by date
      filteredEntries.sort((a, b) => new Date(a.date) - new Date(b.date));
      
      // Calculate running balance
      let runningBalance = 0;
      let totalDebit = 0;
      let totalCredit = 0;
      
      const tableData = filteredEntries.map(entry => {
        if (entry.type === 'debit') {
          runningBalance += entry.amount;
          totalDebit += entry.amount;
        } else {
          runningBalance -= entry.amount;
          totalCredit += entry.amount;
        }
        
        return [
          formatDate(entry.date),
          entry.title,
          entry.description || '-',
          entry.reference || '-',
          entry.productName || '-',
          entry.type === 'debit' ? formatCurrency(entry.amount) : '-',
          entry.type === 'credit' ? formatCurrency(entry.amount) : '-',
          formatCurrency(runningBalance)
        ];
      });
      
      // Update title with customer name
      doc.setFontSize(18);
      doc.text(`${customerName}'s Ledger Report`, 14, 22);
      
      // Add summary
      doc.setFontSize(12);
      doc.text(`Total Debit: ${formatCurrency(totalDebit)}`, 14, 48);
      doc.text(`Total Credit: ${formatCurrency(totalCredit)}`, 14, 55);
      doc.text(`Balance: ${formatCurrency(totalDebit - totalCredit)}`, 14, 62);
      
      doc.autoTable({
        startY: 68,
        head: [['Date', 'Title', 'Description', 'Reference', 'Product', 'Debit', 'Credit', 'Balance']],
        body: tableData,
        headStyles: { fillColor: [0, 0, 0] }
      });
      
    } else if (reportType === 'expense') {
      // Filter expenses by date range
      const filteredExpenses = expensesData.filter(expense => {
        const expenseDate = new Date(expense.date);
        return expenseDate >= new Date(startDate) && expenseDate <= new Date(endDate);
      });
      
      // Calculate category totals
      const categorySummary = {};
      
      filteredExpenses.forEach(expense => {
        if (!categorySummary[expense.category]) {
          categorySummary[expense.category] = {
            debit: 0,
            credit: 0
          };
        }
        
        if (expense.type === 'debit') {
          categorySummary[expense.category].debit += expense.amount;
        } else {
          categorySummary[expense.category].credit += expense.amount;
        }
      });
      
      // Generate summary table
      const summaryData = Object.entries(categorySummary).map(([category, data]) => [
        category,
        formatCurrency(data.debit),
        formatCurrency(data.credit),
        formatCurrency(data.credit - data.debit)
      ]);
      
      // Calculate totals
      let totalDebit = 0;
      let totalCredit = 0;
      
      Object.values(categorySummary).forEach(data => {
        totalDebit += data.debit;
        totalCredit += data.credit;
      });
      
      // Add totals row
      summaryData.push([
        'TOTAL',
        formatCurrency(totalDebit),
        formatCurrency(totalCredit),
        formatCurrency(totalCredit - totalDebit)
      ]);
      
      doc.autoTable({
        startY: 48,
        head: [['Category', 'Expense', 'Income', 'Net']],
        body: summaryData,
        headStyles: { fillColor: [0, 0, 0] }
      });
      
      // Generate entries table
      const finalY = doc.lastAutoTable ? doc.lastAutoTable.finalY : 48;
      
      doc.autoTable({
        startY: finalY + 15,
        head: [['Date', 'Category', 'Title', 'Description', 'Amount', 'Type']],
        body: filteredExpenses.map(expense => [
          formatDate(expense.date),
          expense.category,
          expense.title,
          expense.description || '-',
          formatCurrency(expense.amount),
          expense.type === 'debit' ? 'Expense' : 'Income'
        ]),
        headStyles: { fillColor: [0, 0, 0] }
      });
    }
    
    // Save the PDF
    doc.save(`${pageTitle.toLowerCase().replace(/\s+/g, '-')}-${startDate}-to-${endDate}.pdf`);
    
    // Close modal
    document.getElementById('generate-pdf-modal').style.display = 'none';
    
    showToast('Success', 'PDF generated successfully');
  } catch (error) {
    console.error('Error generating PDF:', error);
    showToast('Error', `Failed to generate PDF: ${error.message}`, 'error');
  }
});

        // Backup and Restore
        document.getElementById('backup-btn').addEventListener('click', async () => {
            try {
                const result = await ipcRenderer.invoke('create-backup');

                if (result.success) {
                    showToast('Success', result.message);
                } else {
                    showToast('Error', result.message, 'error');
                }
            } catch (error) {
                console.error('Error creating backup:', error);
                showToast('Error', 'Failed to create backup', 'error');
            }
        });

        document.getElementById('restore-btn').addEventListener('click', async () => {
            try {
                const result = await ipcRenderer.invoke('restore-backup');

                if (result.success) {
                    showToast('Success', result.message);

                    // Refresh data
                    loadDashboardData();
                    loadCategories();
                    loadExpenseCategories();
                } else {
                    showToast('Error', result.message, 'error');
                }
            } catch (error) {
                console.error('Error restoring backup:', error);
                showToast('Error', 'Failed to restore backup', 'error');
            }
        });

        // Update current date and time in the footer
        const usernamePlaceholder = document.querySelector('.font-medium');
        const datePlaceholder = document.querySelector('.text-xs.text-gray-500');

        usernamePlaceholder.textContent = 'itshassanraza';
        datePlaceholder.textContent = '2025-04-04 19:44:47';
        // Add these functions to your existing JavaScript code before the closing script tag

// Setup action buttons for data entries (edit and delete)
function setupActionButtons() {
  // Add action column headers to tables if missing
  const tables = [
    { id: 'stock-entries-table', header: 'Actions' },
    { id: 'customers-table', header: 'Actions' },
    { id: 'customer-ledger-table', header: 'Actions' },
    { id: 'expenses-table', header: 'Actions' }
  ];

  tables.forEach(table => {
    const tableElement = document.getElementById(table.id);
    if (!tableElement) return;
    
    const headerRow = tableElement.querySelector('thead tr');
    // Check if Actions column already exists
    if (!headerRow.querySelector('th:last-child').textContent.includes('Actions')) {
      const actionHeader = document.createElement('th');
      actionHeader.textContent = table.header;
      headerRow.appendChild(actionHeader);
    }
  });
}

// Call setupActionButtons when DOM is loaded
document.addEventListener('DOMContentLoaded', setupActionButtons);

// Create modals for edit functionality
function createEditModals() {
  const modalHTML = `
    <!-- Edit Stock Modal -->
    <div class="modal" id="edit-stock-modal" style="display: none;">
      <div class="modal-content">
        <div class="modal-header">
          <h3 class="modal-title">Edit Stock</h3>
          <span class="modal-close" id="close-edit-stock-modal">&times;</span>
        </div>
        <form id="edit-stock-form">
          <input type="hidden" id="edit-stock-id">
          <div class="form-group">
            <label for="edit-stock-name">Item Name</label>
            <input type="text" id="edit-stock-name" class="form-control" required>
          </div>
          <div class="form-group">
            <label for="edit-stock-category">Category</label>
            <select id="edit-stock-category" class="form-control" required>
              <!-- Categories will be loaded here -->
            </select>
          </div>
          <div class="form-group">
            <label for="edit-stock-color">Color</label>
            <input type="text" id="edit-stock-color" class="form-control">
          </div>
          <div class="form-group">
            <label for="edit-stock-quantity">Quantity</label>
            <input type="number" id="edit-stock-quantity" class="form-control" min="0" required>
          </div>
          <div class="form-group">
            <label for="edit-stock-price">Price per Unit</label>
            <input type="number" id="edit-stock-price" class="form-control" min="0" step="0.01" required>
          </div>
          <div class="form-group">
            <label for="edit-stock-date">Date</label>
            <input type="date" id="edit-stock-date" class="form-control" required>
          </div>
          <button type="submit" class="btn btn-primary w-full">Update Stock</button>
        </form>
      </div>
    </div>

    <!-- Edit Transaction Modal -->
    <div class="modal" id="edit-transaction-modal" style="display: none;">
      <div class="modal-content">
        <div class="modal-header">
          <h3 class="modal-title">Edit Transaction</h3>
          <span class="modal-close" id="close-edit-transaction-modal">&times;</span>
        </div>
        <form id="edit-transaction-form">
          <input type="hidden" id="edit-transaction-id">
          <input type="hidden" id="edit-transaction-customer-id">
          <div class="form-group">
            <label for="edit-transaction-title">Title</label>
            <input type="text" id="edit-transaction-title" class="form-control" required>
          </div>
          <div class="form-group">
            <label for="edit-transaction-description">Description</label>
            <textarea id="edit-transaction-description" class="form-control" rows="2"></textarea>
          </div>
          <div class="form-group">
            <label for="edit-transaction-amount">Amount</label>
            <input type="number" id="edit-transaction-amount" class="form-control" min="0" step="0.01" required>
          </div>
          <div class="form-group">
            <label for="edit-transaction-reference">Reference No</label>
            <input type="text" id="edit-transaction-reference" class="form-control">
          </div>
          <div class="form-group">
            <label for="edit-transaction-date">Date</label>
            <input type="date" id="edit-transaction-date" class="form-control" required>
          </div>
          <div class="form-group">
            <label>Transaction Type</label>
            <div class="flex mt-2">
              <label class="inline-flex items-center mr-4">
                <input type="radio" name="edit-transaction-type" value="debit">
                <span class="ml-2">Debit (You Give)</span>
              </label>
              <label class="inline-flex items-center">
                <input type="radio" name="edit-transaction-type" value="credit">
                <span class="ml-2">Credit (You Get)</span>
              </label>
            </div>
          </div>
          <button type="submit" class="btn btn-primary w-full">Update Transaction</button>
        </form>
      </div>
    </div>

    <!-- Edit Expense Modal -->
    <div class="modal" id="edit-expense-modal" style="display: none;">
      <div class="modal-content">
        <div class="modal-header">
          <h3 class="modal-title">Edit Expense</h3>
          <span class="modal-close" id="close-edit-expense-modal">&times;</span>
        </div>
        <form id="edit-expense-form">
          <input type="hidden" id="edit-expense-id">
          <div class="form-group">
            <label for="edit-expense-category">Category</label>
            <select id="edit-expense-category" class="form-control" required>
              <!-- Expense categories will be loaded here -->
            </select>
          </div>
          <div class="form-group">
            <label for="edit-expense-title">Title</label>
            <input type="text" id="edit-expense-title" class="form-control" required>
          </div>
          <div class="form-group">
            <label for="edit-expense-description">Description</label>
            <textarea id="edit-expense-description" class="form-control" rows="2"></textarea>
          </div>
          <div class="form-group">
            <label for="edit-expense-amount">Amount</label>
            <input type="number" id="edit-expense-amount" class="form-control" min="0" step="0.01" required>
          </div>
          <div class="form-group">
            <label for="edit-expense-date">Date</label>
            <input type="date" id="edit-expense-date" class="form-control" required>
          </div>
          <div class="form-group">
            <label>Transaction Type</label>
            <div class="flex mt-2">
              <label class="inline-flex items-center mr-4">
                <input type="radio" name="edit-expense-type" value="debit">
                <span class="ml-2">Debit (Expense)</span>
              </label>
              <label class="inline-flex items-center">
                <input type="radio" name="edit-expense-type" value="credit">
                <span class="ml-2">Credit (Income)</span>
              </label>
            </div>
          </div>
          <button type="submit" class="btn btn-primary w-full">Update Expense</button>
        </form>
      </div>
    </div>

    <!-- Delete Confirmation Modal -->
    <div class="modal" id="delete-confirmation-modal" style="display: none;">
      <div class="modal-content" style="max-width: 400px;">
        <div class="modal-header">
          <h3 class="modal-title">Confirm Delete</h3>
          <span class="modal-close" id="close-delete-confirmation-modal">&times;</span>
        </div>
        <div class="p-4">
          <p class="mb-4">Are you sure you want to delete this item? This action cannot be undone.</p>
          <input type="hidden" id="delete-item-id">
          <input type="hidden" id="delete-item-type">
          <div class="flex justify-end">
            <button class="btn btn-secondary mr-2" id="cancel-delete-btn">Cancel</button>
            <button class="btn btn-primary bg-red-600 hover:bg-red-700" id="confirm-delete-btn">Delete</button>
          </div>
        </div>
      </div>
    </div>
  `;

  // Create a temporary div to parse the HTML
  const tempDiv = document.createElement('div');
  tempDiv.innerHTML = modalHTML;

  // Append all the modals to the body
  while (tempDiv.firstChild) {
    document.body.appendChild(tempDiv.firstChild);
  }

  // Setup modal close handlers
  setupModal('edit-stock-modal', null, 'close-edit-stock-modal');
  setupModal('edit-transaction-modal', null, 'close-edit-transaction-modal');
  setupModal('edit-expense-modal', null, 'close-edit-expense-modal');
  setupModal('delete-confirmation-modal', null, 'close-delete-confirmation-modal');
  
  // Setup cancel button for delete confirmation
  document.getElementById('cancel-delete-btn').addEventListener('click', () => {
    document.getElementById('delete-confirmation-modal').style.display = 'none';
  });
}

// Call this function when the DOM is fully loaded
document.addEventListener('DOMContentLoaded', createEditModals);

// Add these functions to handle editing and deleting items

// Update the loadStockData function to include action buttons
async function loadStockData() {
  try {
    stockData = await ipcRenderer.invoke('get-stocks');
    
    // Process stock data for summary
    const stockSummary = {};
    
    stockData.forEach(stock => {
      const key = `${stock.name}`;
      
      if (!stockSummary[key]) {
        stockSummary[key] = {
          name: stock.name,
          category: stock.category,
          totalQuantity: 0,
          totalValue: 0,
          entries: []
        };
      }
      
      stockSummary[key].totalQuantity += stock.quantity;
      stockSummary[key].totalValue += stock.quantity * stock.price;
      stockSummary[key].entries.push(stock);
    });
    
    // Update stock summary table
    const summaryTableBody = document.getElementById('stock-summary-body');
    summaryTableBody.innerHTML = '';
    
    Object.values(stockSummary).forEach(item => {
      if (item.totalQuantity > 0) {
        const averagePrice = item.totalValue / item.totalQuantity;
        
        const row = document.createElement('tr');
        row.innerHTML = `
          <td>${item.name}</td>
          <td>${item.category}</td>
          <td>${item.totalQuantity}</td>
          <td>${formatCurrency(averagePrice)}</td>
          <td>${formatCurrency(item.totalValue)}</td>
        `;
        summaryTableBody.appendChild(row);
      }
    });
    
    // Update stock entries table
    const entriesTableBody = document.getElementById('stock-entries-body');
    entriesTableBody.innerHTML = '';
    
    stockData.forEach(stock => {
      const row = document.createElement('tr');
      row.innerHTML = `
        <td>${formatDate(stock.date)}</td>
        <td>${stock.name}</td>
        <td>${stock.category}</td>
        <td>${stock.color || '-'}</td>
        <td>${stock.quantity}</td>
        <td>${formatCurrency(stock.price)}</td>
        <td>${formatCurrency(stock.quantity * stock.price)}</td>
        <td>
          <button class="btn btn-secondary btn-sm edit-stock" data-id="${stock._id}">
            <i class="fas fa-edit"></i>
          </button>
          <button class="btn btn-secondary btn-sm delete-stock" data-id="${stock._id}">
            <i class="fas fa-trash-alt"></i>
          </button>
        </td>
      `;
      entriesTableBody.appendChild(row);
      
      // Attach event listeners to buttons
      const editBtn = row.querySelector('.edit-stock');
      const deleteBtn = row.querySelector('.delete-stock');
      
      editBtn.addEventListener('click', () => editStock(stock._id));
      deleteBtn.addEventListener('click', () => deleteItem(stock._id, 'stock'));
    });
    
  } catch (error) {
    console.error('Error loading stock data:', error);
    showToast('Error', 'Failed to load stock data', 'error');
  }
}

// Similarly update the loadCustomersData, viewCustomerLedger, and loadExpensesData functions
// Here's the update for loadExpensesData as an example

async function loadExpensesData() {
  try {
    expensesData = await ipcRenderer.invoke('get-expenses');
    expenseCategoriesData = await ipcRenderer.invoke('get-expense-categories');
    
    // Calculate category totals
    const categorySummary = {};
    expenseCategoriesData.forEach(category => {
      categorySummary[category.name] = {
        debit: 0,
        credit: 0
      };
    });
    
    expensesData.forEach(expense => {
      if (!categorySummary[expense.category]) {
        categorySummary[expense.category] = {
          debit: 0,
          credit: 0
        };
      }
      
      if (expense.type === 'debit') {
        categorySummary[expense.category].debit += expense.amount;
      } else {
        categorySummary[expense.category].credit += expense.amount;
      }
    });
    
    // Update expense summary
    const expenseSummary = document.getElementById('expense-summary');
    expenseSummary.innerHTML = '';
    
    // Create a grid for summary boxes
    const summaryGrid = document.createElement('div');
    summaryGrid.className = 'grid';
    expenseSummary.appendChild(summaryGrid);
    
    // Calculate totals
    let totalDebit = 0;
    let totalCredit = 0;
    
    // Add category summary boxes
    Object.entries(categorySummary).forEach(([category, data]) => {
      totalDebit += data.debit;
      totalCredit += data.credit;
      
      const box = document.createElement('div');
      box.className = 'summary-box';
      box.innerHTML = `
        <div class="summary-box-icon">
          <i class="fas fa-tag"></i>
        </div>
        <div class="summary-box-content">
          <h3>${category}</h3>
          <p>Expense: ${formatCurrency(data.debit)} | Income: ${formatCurrency(data.credit)}</p>
          <p>Net: ${formatCurrency(data.credit - data.debit)}</p>
        </div>
      `;
      summaryGrid.appendChild(box);
    });
    
    // Add total summary box
    const totalBox = document.createElement('div');
    totalBox.className = 'summary-box';
    totalBox.innerHTML = `
      <div class="summary-box-icon">
        <i class="fas fa-calculator"></i>
      </div>
      <div class="summary-box-content">
        <h3>Total</h3>
        <p>Expense: ${formatCurrency(totalDebit)} | Income: ${formatCurrency(totalCredit)}</p>
        <p>Net: ${formatCurrency(totalCredit - totalDebit)}</p>
      </div>
    `;
    summaryGrid.appendChild(totalBox);
    
    // Update expenses table
    const expensesTableBody = document.getElementById('expenses-body');
    expensesTableBody.innerHTML = '';
    
    expensesData.forEach(expense => {
      const row = document.createElement('tr');
      row.innerHTML = `
        <td>${formatDate(expense.date)}</td>
        <td>${expense.category}</td>
        <td>${expense.title}</td>
        <td>${expense.description || '-'}</td>
        <td>${formatCurrency(expense.amount)}</td>
        <td>
          <span class="badge ${expense.type === 'debit' ? 'badge-danger' : 'badge-success'}">
            ${expense.type === 'debit' ? 'Expense' : 'Income'}
          </span>
        </td>
        <td>
          <button class="btn btn-secondary btn-sm edit-expense" data-id="${expense._id}">
            <i class="fas fa-edit"></i>
          </button>
          <button class="btn btn-secondary btn-sm delete-expense" data-id="${expense._id}">
            <i class="fas fa-trash-alt"></i>
          </button>
        </td>
      `;
      expensesTableBody.appendChild(row);
      
      // Attach event listeners to buttons
      const editBtn = row.querySelector('.edit-expense');
      const deleteBtn = row.querySelector('.delete-expense');
      
      editBtn.addEventListener('click', () => editExpense(expense._id));
      deleteBtn.addEventListener('click', () => deleteItem(expense._id, 'expense'));
    });
    
  } catch (error) {
    console.error('Error loading expenses data:', error);
    showToast('Error', 'Failed to load expenses data', 'error');
  }
}

// Now add these handler functions

// Function to edit stock
function editStock(stockId) {
  const stock = stockData.find(item => item._id === stockId);
  if (!stock) return;
  
  // Load categories into select dropdown
  const categorySelect = document.getElementById('edit-stock-category');
  categorySelect.innerHTML = '';
  
  categoriesData.forEach(category => {
    const option = document.createElement('option');
    option.value = category.name;
    option.textContent = category.name;
    option.selected = category.name === stock.category;
    categorySelect.appendChild(option);
  });
  
  // Populate form with stock data
  document.getElementById('edit-stock-id').value = stock._id;
  document.getElementById('edit-stock-name').value = stock.name;
  document.getElementById('edit-stock-color').value = stock.color || '';
  document.getElementById('edit-stock-quantity').value = stock.quantity;
  document.getElementById('edit-stock-price').value = stock.price;
  document.getElementById('edit-stock-date').value = stock.date.split('T')[0];
  
  // Show modal
  document.getElementById('edit-stock-modal').style.display = 'flex';
}

// Function to edit expense
function editExpense(expenseId) {
  const expense = expensesData.find(item => item._id === expenseId);
  if (!expense) return;
  
  // Load categories into select dropdown
  const categorySelect = document.getElementById('edit-expense-category');
  categorySelect.innerHTML = '';
  
  expenseCategoriesData.forEach(category => {
    const option = document.createElement('option');
    option.value = category.name;
    option.textContent = category.name;
    option.selected = category.name === expense.category;
    categorySelect.appendChild(option);
  });
  
  // Populate form with expense data
  document.getElementById('edit-expense-id').value = expense._id;
  document.getElementById('edit-expense-title').value = expense.title;
  document.getElementById('edit-expense-description').value = expense.description || '';
  document.getElementById('edit-expense-amount').value = expense.amount;
  document.getElementById('edit-expense-date').value = expense.date.split('T')[0];
  
  // Set radio button based on type
  document.querySelector(`input[name="edit-expense-type"][value="${expense.type}"]`).checked = true;
  
  // Show modal
  document.getElementById('edit-expense-modal').style.display = 'flex';
}

// Function to edit transaction (ledger entry)
function editTransaction(transactionId) {
  const transaction = ledgerEntries.find(item => item._id === transactionId);
  if (!transaction) return;
  
  // Populate form with transaction data
  document.getElementById('edit-transaction-id').value = transaction._id;
  document.getElementById('edit-transaction-customer-id').value = transaction.customerId;
  document.getElementById('edit-transaction-title').value = transaction.title;
  document.getElementById('edit-transaction-description').value = transaction.description || '';
  document.getElementById('edit-transaction-amount').value = transaction.amount;
  document.getElementById('edit-transaction-reference').value = transaction.reference || '';
  document.getElementById('edit-transaction-date').value = transaction.date.split('T')[0];
  
  // Set radio button based on type
  document.querySelector(`input[name="edit-transaction-type"][value="${transaction.type}"]`).checked = true;
  
  // Show modal
  document.getElementById('edit-transaction-modal').style.display = 'flex';
}

// Function to show delete confirmation
function deleteItem(itemId, itemType) {
  document.getElementById('delete-item-id').value = itemId;
  document.getElementById('delete-item-type').value = itemType;
  document.getElementById('delete-confirmation-modal').style.display = 'flex';
}

// Add the Edit Stock form handler
document.getElementById('edit-stock-form').addEventListener('submit', async (event) => {
  event.preventDefault();
  
  const stockId = document.getElementById('edit-stock-id').value;
  const updatedStock = {
    name: document.getElementById('edit-stock-name').value,
    category: document.getElementById('edit-stock-category').value,
    color: document.getElementById('edit-stock-color').value,
    quantity: parseInt(document.getElementById('edit-stock-quantity').value),
    price: parseFloat(document.getElementById('edit-stock-price').value),
    date: document.getElementById('edit-stock-date').value
  };
  
  try {
    await ipcRenderer.invoke('update-stock', stockId, updatedStock);
    
    // Close modal
    document.getElementById('edit-stock-modal').style.display = 'none';
    
    // Refresh stock data
    loadStockData();
    loadDashboardData();
    
    showToast('Success', 'Stock updated successfully');
  } catch (error) {
    console.error('Error updating stock:', error);
    showToast('Error', 'Failed to update stock', 'error');
  }
});

// Add the Edit Expense form handler
document.getElementById('edit-expense-form').addEventListener('submit', async (event) => {
  event.preventDefault();
  
  const expenseId = document.getElementById('edit-expense-id').value;
  const updatedExpense = {
    category: document.getElementById('edit-expense-category').value,
    title: document.getElementById('edit-expense-title').value,
    description: document.getElementById('edit-expense-description').value,
    amount: parseFloat(document.getElementById('edit-expense-amount').value),
    date: document.getElementById('edit-expense-date').value,
    type: document.querySelector('input[name="edit-expense-type"]:checked').value
  };
  
  try {
    await ipcRenderer.invoke('update-expense', expenseId, updatedExpense);
    
    // Close modal
    document.getElementById('edit-expense-modal').style.display = 'none';
    
    // Refresh expense data
    loadExpensesData();
    loadDashboardData();
    
    showToast('Success', 'Expense updated successfully');
  } catch (error) {
    console.error('Error updating expense:', error);
    showToast('Error', 'Failed to update expense', 'error');
  }
});

// Add the Edit Transaction form handler
document.getElementById('edit-transaction-form').addEventListener('submit', async (event) => {
  event.preventDefault();
  
  const transactionId = document.getElementById('edit-transaction-id').value;
  const customerId = document.getElementById('edit-transaction-customer-id').value;
  const updatedTransaction = {
    title: document.getElementById('edit-transaction-title').value,
    description: document.getElementById('edit-transaction-description').value,
    amount: parseFloat(document.getElementById('edit-transaction-amount').value),
    reference: document.getElementById('edit-transaction-reference').value,
    date: document.getElementById('edit-transaction-date').value,
    type: document.querySelector('input[name="edit-transaction-type"]:checked').value
  };
  
  try {
    await ipcRenderer.invoke('update-ledger-entry', transactionId, updatedTransaction);
    
    // Close modal
    document.getElementById('edit-transaction-modal').style.display = 'none';
    
    // Refresh ledger data
    viewCustomerLedger(customerId, document.getElementById('customer-name-title').textContent.replace("'s Ledger", ""));
    
    showToast('Success', 'Transaction updated successfully');
  } catch (error) {
    console.error('Error updating transaction:', error);
    showToast('Error', 'Failed to update transaction', 'error');
  }
});

// Add the Delete Confirmation handler
document.getElementById('confirm-delete-btn').addEventListener('click', async () => {
  const itemId = document.getElementById('delete-item-id').value;
  const itemType = document.getElementById('delete-item-type').value;
  
  try {
    let success = false;
    
    if (itemType === 'stock') {
      success = await ipcRenderer.invoke('delete-stock', itemId);
      if (success) loadStockData();
    } else if (itemType === 'expense') {
      success = await ipcRenderer.invoke('delete-expense', itemId);
      if (success) loadExpensesData();
    } else if (itemType === 'transaction') {
      success = await ipcRenderer.invoke('delete-ledger-entry', itemId);
      if (success) {
        const customerId = currentCustomerId;
        viewCustomerLedger(customerId, document.getElementById('customer-name-title').textContent.replace("'s Ledger", ""));
      }
    }
    
    // Close modal
    document.getElementById('delete-confirmation-modal').style.display = 'none';
    
    // Refresh dashboard
    loadDashboardData();
    
    if (success) {
      showToast('Success', 'Item deleted successfully');
    } else {
      showToast('Error', 'Failed to delete item', 'error');
    }
  } catch (error) {
    console.error('Error deleting item:', error);
    showToast('Error', 'Failed to delete item', 'error');
  }
});

// Update handlers
ipcMain.handle('update-stock', async (event, stockId, updatedData) => {
  return new Promise((resolve, reject) => {
    db.stocks.update({ _id: stockId }, { $set: updatedData }, {}, (err, numReplaced) => {
      if (err) reject(err);
      resolve(numReplaced > 0);
    });
  });
});

ipcMain.handle('update-ledger-entry', async (event, entryId, updatedData) => {
  return new Promise((resolve, reject) => {
    db.ledger.update({ _id: entryId }, { $set: updatedData }, {}, (err, numReplaced) => {
      if (err) reject(err);
      resolve(numReplaced > 0);
    });
  });
});

ipcMain.handle('update-expense', async (event, expenseId, updatedData) => {
  return new Promise((resolve, reject) => {
    db.expenses.update({ _id: expenseId }, { $set: updatedData }, {}, (err, numReplaced) => {
      if (err) reject(err);
      resolve(numReplaced > 0);
    });
  });
});

// Delete handlers
ipcMain.handle('delete-stock', async (event, stockId) => {
  return new Promise((resolve, reject) => {
    db.stocks.remove({ _id: stockId }, {}, (err, numRemoved) => {
      if (err) reject(err);
      resolve(numRemoved > 0);
    });
  });
});

ipcMain.handle('delete-ledger-entry', async (event, entryId) => {
  return new Promise((resolve, reject) => {
    db.ledger.remove({ _id: entryId }, {}, (err, numRemoved) => {
      if (err) reject(err);
      resolve(numRemoved > 0);
    });
  });
});

ipcMain.handle('delete-expense', async (event, expenseId) => {
  return new Promise((resolve, reject) => {
    db.expenses.remove({ _id: expenseId }, {}, (err, numRemoved) => {
      if (err) reject(err);
      resolve(numRemoved > 0);
    });
  });
});
    </script>
</body>

</html>